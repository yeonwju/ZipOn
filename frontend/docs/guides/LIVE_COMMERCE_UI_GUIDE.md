# ë¼ì´ë¸Œ ì»¤ë¨¸ìŠ¤ UI ê°€ì´ë“œ

## ğŸ“‹ ëª©ì°¨

1. [ê°œìš”](#ê°œìš”)
2. [í™”ë©´ êµ¬ì¡°](#í™”ë©´-êµ¬ì¡°)
3. [ì»´í¬ë„ŒíŠ¸ ì„¤ëª…](#ì»´í¬ë„ŒíŠ¸-ì„¤ëª…)
4. [ì‚¬ìš© ì˜ˆì œ](#ì‚¬ìš©-ì˜ˆì œ)
5. [ì»¤ìŠ¤í„°ë§ˆì´ì§•](#ì»¤ìŠ¤í„°ë§ˆì´ì§•)
6. [API ì—°ë™](#api-ì—°ë™)

---

## ê°œìš”

ë¼ì´ë¸Œ ì»¤ë¨¸ìŠ¤ í˜ì´ì§€ëŠ” ì‹¤ì‹œê°„ ë°©ì†¡ê³¼ ì‹œì²­ì ê°„ì˜ ì¸í„°ë™ì…˜ì„ ì œê³µí•˜ëŠ” í˜ì´ì§€ì…ë‹ˆë‹¤.

### ì£¼ìš” ê¸°ëŠ¥

- âœ… **ì‹¤ì‹œê°„ ë¹„ë””ì˜¤ ìŠ¤íŠ¸ë¦¬ë°**
- âœ… **ì±„íŒ… ì‹œìŠ¤í…œ** (ë©”ì‹œì§€ ì†¡ìˆ˜ì‹ )
- âœ… **ì¢‹ì•„ìš” ê¸°ëŠ¥** (ì• ë‹ˆë©”ì´ì…˜ í¬í•¨)
- âœ… **ì‹œì²­ì ìˆ˜ í‘œì‹œ**
- âœ… **ë°©ì†¡ ì •ë³´ ë° ì§„í–‰ì í”„ë¡œí•„**
- âœ… **ë¯¸ë‹ˆ í”Œë ˆì´ì–´ ì§€ì›**
- âœ… **ë°©ì†¡ ì¢…ë£Œ ê¸°ëŠ¥** (ì§„í–‰ì ì „ìš©)

---

## í™”ë©´ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [â†] ë’¤ë¡œê°€ê¸°       [â–¡] ë¯¸ë‹ˆí”Œë ˆì´ì–´  â”‚ â† LiveHeader (íˆ¬ëª…)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ  ë°©ì†¡ íƒ€ì´í‹€                        â”‚ â† LiveHostInfo
â”‚ [í”„ë¡œí•„] ì§„í–‰ì ì´ë¦„                  â”‚
â”‚                                      â”‚
â”‚                           ğŸ‘ 342    â”‚ â† LiveInteraction
â”‚         ë¹„ë””ì˜¤ ìŠ¤íŠ¸ë¦¼                 â”‚    (ì‹œì²­ììˆ˜)
â”‚                                      â”‚
â”‚                           â¤ï¸ 1.5K   â”‚
â”‚                                      â”‚
â”‚                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [í™ê¸¸ë™] ì•ˆë…•í•˜ì„¸ìš”!                  â”‚
â”‚ [ê¹€ì² ìˆ˜] ë§¤ë¬¼ ì¢‹ë„¤ìš”!                â”‚ â† LiveChatList
â”‚ ...                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ë©”ì‹œì§€ ì…ë ¥ì°½] [ì „ì†¡]     [ë°©ì†¡ì¢…ë£Œ]  â”‚ â† LiveChatInput
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    + LiveEndButton
```

---

## ì»´í¬ë„ŒíŠ¸ ì„¤ëª…

### 1. LiveHeader

**ìœ„ì¹˜**: ìƒë‹¨ (íˆ¬ëª… ë°°ê²½)  
**ê¸°ëŠ¥**: ë’¤ë¡œê°€ê¸°, ë¯¸ë‹ˆí”Œë ˆì´ì–´ ë²„íŠ¼

```tsx
<LiveHeader 
  onBack={() => router.back()} 
  onMinimize={handleMinimize} 
/>
```

**Props:**
- `onBack`: ë’¤ë¡œê°€ê¸° ë²„íŠ¼ í´ë¦­ í•¸ë“¤ëŸ¬
- `onMinimize`: ë¯¸ë‹ˆí”Œë ˆì´ì–´ ë²„íŠ¼ í´ë¦­ í•¸ë“¤ëŸ¬

---

### 2. LiveHostInfo

**ìœ„ì¹˜**: ì¢Œì¸¡ ìƒë‹¨  
**ê¸°ëŠ¥**: ë°©ì†¡ íƒ€ì´í‹€, ì§„í–‰ì ì •ë³´ í‘œì‹œ

```tsx
<LiveHostInfo
  title="ğŸ  ê°•ë‚¨ ì—­ì‚¼ë™ ì‹ ì¶• ì˜¤í”¼ìŠ¤í…” ì‹¤ì‹œê°„ íˆ¬ì–´"
  hostName="ë³€ê°€ì›"
  hostProfileImage="/profile.svg"
/>
```

**Props:**
- `title`: ë°©ì†¡ ì œëª©
- `hostName`: ì§„í–‰ì ì´ë¦„
- `hostProfileImage`: ì§„í–‰ì í”„ë¡œí•„ ì´ë¯¸ì§€ (optional, ê¸°ë³¸ê°’: `/profile.svg`)

---

### 3. LiveInteraction

**ìœ„ì¹˜**: ìš°ì¸¡ ìƒë‹¨  
**ê¸°ëŠ¥**: ì‹œì²­ì ìˆ˜, ì¢‹ì•„ìš” ë²„íŠ¼ ë° ìˆ˜

```tsx
<LiveInteraction 
  initialViewers={342} 
  initialLikes={1523} 
/>
```

**Props:**
- `initialViewers`: ì´ˆê¸° ì‹œì²­ì ìˆ˜ (optional, ê¸°ë³¸ê°’: 0)
- `initialLikes`: ì´ˆê¸° ì¢‹ì•„ìš” ìˆ˜ (optional, ê¸°ë³¸ê°’: 0)

**íŠ¹ì§•:**
- ì¢‹ì•„ìš” ë²„íŠ¼ í´ë¦­ ì‹œ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
- 5ì´ˆ í›„ ë‹¤ì‹œ ì¢‹ì•„ìš” ê°€ëŠ¥ (ì¤‘ë³µ ë°©ì§€)

---

### 4. LiveChatContainer

**ìœ„ì¹˜**: í•˜ë‹¨ (45% ë†’ì´)  
**ê¸°ëŠ¥**: ì±„íŒ… ëª©ë¡ + ì…ë ¥ì°½ í†µí•© ì»´í¬ë„ŒíŠ¸

```tsx
<LiveChatContainer 
  isHost={true} 
  userName="ë³€ê°€ì›" 
/>
```

**Props:**
- `isHost`: ì§„í–‰ì ì—¬ë¶€ (ë©”ì‹œì§€ì— 'ì§„í–‰ì' ë±ƒì§€ í‘œì‹œ)
- `userName`: í˜„ì¬ ì‚¬ìš©ì ì´ë¦„ (ë©”ì‹œì§€ ì „ì†¡ ì‹œ ì‚¬ìš©)

---

### 5. LiveChatList

**ìœ„ì¹˜**: ì±„íŒ… ì»¨í…Œì´ë„ˆ ë‚´ë¶€  
**ê¸°ëŠ¥**: ì±„íŒ… ë©”ì‹œì§€ ëª©ë¡ í‘œì‹œ

```tsx
<LiveChatList messages={messages} />
```

**Props:**
- `messages`: ì±„íŒ… ë©”ì‹œì§€ ë°°ì—´

**ChatMessage íƒ€ì…:**
```typescript
interface ChatMessage {
  id: string
  userName: string
  message: string
  timestamp: Date
  isHost?: boolean  // ì§„í–‰ì ì—¬ë¶€
}
```

---

### 6. LiveChatInput

**ìœ„ì¹˜**: ì±„íŒ… ì»¨í…Œì´ë„ˆ í•˜ë‹¨  
**ê¸°ëŠ¥**: ë©”ì‹œì§€ ì…ë ¥ ë° ì „ì†¡

```tsx
<LiveChatInput 
  onSendMessage={handleSendMessage} 
  disabled={false} 
/>
```

**Props:**
- `onSendMessage`: ë©”ì‹œì§€ ì „ì†¡ í•¸ë“¤ëŸ¬ `(message: string) => void`
- `disabled`: ì…ë ¥ ë¹„í™œì„±í™” (optional)

---

### 7. LiveEndButton

**ìœ„ì¹˜**: ìš°ì¸¡ í•˜ë‹¨  
**ê¸°ëŠ¥**: ë°©ì†¡ ì¢…ë£Œ (ì§„í–‰ì ì „ìš©)

```tsx
{isHost && <LiveEndButton onEnd={handleEndBroadcast} />}
```

**Props:**
- `onEnd`: ë°©ì†¡ ì¢…ë£Œ í•¸ë“¤ëŸ¬

**íŠ¹ì§•:**
- í™•ì¸ ëª¨ë‹¬ í¬í•¨ (ì‹¤ìˆ˜ ë°©ì§€)
- ì§„í–‰ìë§Œ ì‚¬ìš©

---

## ì‚¬ìš© ì˜ˆì œ

### ê¸°ë³¸ ì‚¬ìš©

```tsx
'use client'

import { useRouter } from 'next/navigation'
import { useState } from 'react'

import {
  LiveBroadcast,
  LiveHeader,
  LiveHostInfo,
  LiveInteraction,
  LiveChatContainer,
  LiveEndButton,
} from '@/components/features/live'
import { useMiniPlayerStore } from '@/store/miniPlayer'

export default function OnAirPage() {
  const router = useRouter()
  const { activateMiniPlayer } = useMiniPlayerStore()
  const [currentStream, setCurrentStream] = useState<MediaStream | null>(null)

  // ì‚¬ìš©ì ì •ë³´ (TODO: AuthGuardì—ì„œ ê°€ì ¸ì˜¤ê¸°)
  const isHost = true
  const userName = 'ë³€ê°€ì›'

  // ë¼ì´ë¸Œ ì •ë³´ (TODO: APIì—ì„œ ê°€ì ¸ì˜¤ê¸°)
  const liveInfo = {
    title: 'ğŸ  ê°•ë‚¨ ì—­ì‚¼ë™ ì‹ ì¶• ì˜¤í”¼ìŠ¤í…” ì‹¤ì‹œê°„ íˆ¬ì–´',
    hostName: 'ë³€ê°€ì›',
    hostProfileImage: '/profile.svg',
    viewers: 342,
    likes: 1523,
  }

  const handleMinimize = () => {
    if (currentStream) {
      const clonedStream = currentStream.clone()
      activateMiniPlayer(clonedStream)
      router.push('/home')
    }
  }

  const handleEndBroadcast = () => {
    // TODO: ë°©ì†¡ ì¢…ë£Œ API í˜¸ì¶œ
    router.push('/live')
  }

  return (
    <main className="relative h-screen overflow-hidden bg-black">
      {/* ë¹„ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ */}
      <LiveBroadcast onStreamReady={setCurrentStream} />

      {/* ìƒë‹¨ í—¤ë” */}
      <LiveHeader onBack={() => router.back()} onMinimize={handleMinimize} />

      {/* ë°©ì†¡ ì •ë³´ */}
      <LiveHostInfo
        title={liveInfo.title}
        hostName={liveInfo.hostName}
        hostProfileImage={liveInfo.hostProfileImage}
      />

      {/* ì¸í„°ë™ì…˜ */}
      <LiveInteraction 
        initialViewers={liveInfo.viewers} 
        initialLikes={liveInfo.likes} 
      />

      {/* ì±„íŒ… */}
      <LiveChatContainer isHost={isHost} userName={userName} />

      {/* ë°©ì†¡ ì¢…ë£Œ (ì§„í–‰ìë§Œ) */}
      {isHost && (
        <div className="absolute bottom-4 right-4 z-20">
          <LiveEndButton onEnd={handleEndBroadcast} />
        </div>
      )}
    </main>
  )
}
```

---

## ì»¤ìŠ¤í„°ë§ˆì´ì§•

### ì±„íŒ… ë†’ì´ ì¡°ì •

```tsx
// LiveChatContainer.tsx
<div className="absolute bottom-0 left-0 right-0 z-10 flex h-[50%] flex-col">
  {/* 50%ë¡œ ë³€ê²½ */}
</div>
```

### ì¢‹ì•„ìš” ì¿¨ë‹¤ìš´ ì‹œê°„ ë³€ê²½

```tsx
// LiveInteraction.tsx
setTimeout(() => {
  setIsLiked(false)
}, 10000) // 10ì´ˆë¡œ ë³€ê²½
```

### ì§„í–‰ì ë©”ì‹œì§€ ìƒ‰ìƒ ë³€ê²½

```tsx
// LiveChatList.tsx
<div className={`... ${
  msg.isHost
    ? 'bg-purple-500/30 border border-purple-400/50'  // ë³´ë¼ìƒ‰ìœ¼ë¡œ ë³€ê²½
    : 'bg-black/30'
}`}>
```

---

## API ì—°ë™

### 1. ë¼ì´ë¸Œ ì •ë³´ ê°€ì ¸ì˜¤ê¸°

```typescript
// hooks/queries/useLive.ts
import { useQuery } from '@tanstack/react-query'
import { queryKeys } from '@/constants/queryKeys'

export function useLiveDetail(liveId: string) {
  return useQuery({
    queryKey: queryKeys.live.detail(Number(liveId)),
    queryFn: () => fetchLiveDetail(liveId),
  })
}

// ì‚¬ìš©
const { data: liveInfo } = useLiveDetail(params.id)
```

### 2. ì±„íŒ… ë©”ì‹œì§€ ì—°ë™ (WebSocket)

```typescript
// hooks/useLiveChat.ts
import { useEffect, useState } from 'react'
import { ChatMessage } from '@/components/features/live'

export function useLiveChat(liveId: string) {
  const [messages, setMessages] = useState<ChatMessage[]>([])
  const [ws, setWs] = useState<WebSocket | null>(null)

  useEffect(() => {
    // WebSocket ì—°ê²°
    const socket = new WebSocket(`wss://api.example.com/live/${liveId}/chat`)
    
    socket.onmessage = (event) => {
      const message = JSON.parse(event.data)
      setMessages(prev => [...prev, message])
    }

    setWs(socket)

    return () => {
      socket.close()
    }
  }, [liveId])

  const sendMessage = (message: string) => {
    if (ws && ws.readyState === WebSocket.OPEN) {
      ws.send(JSON.stringify({ message }))
    }
  }

  return { messages, sendMessage }
}

// ì‚¬ìš©
const { messages, sendMessage } = useLiveChat(params.id)

<LiveChatContainer 
  messages={messages}  // ì‹¤ì‹œê°„ ë©”ì‹œì§€
  onSendMessage={sendMessage}  // WebSocketìœ¼ë¡œ ì „ì†¡
/>
```

### 3. ì¢‹ì•„ìš” API ì—°ë™

```typescript
// hooks/queries/useLiveLike.ts
import { useMutation } from '@tanstack/react-query'

export function useLiveLike(liveId: string) {
  return useMutation({
    mutationFn: () => likeLive(liveId),
    onSuccess: () => {
      // ì¢‹ì•„ìš” ìˆ˜ ì—…ë°ì´íŠ¸
    },
  })
}

// ì‚¬ìš©
const likeMutation = useLiveLike(params.id)

const handleLike = () => {
  likeMutation.mutate()
}
```

### 4. ë°©ì†¡ ì¢…ë£Œ API ì—°ë™

```typescript
// hooks/queries/useLiveEnd.ts
import { useMutation } from '@tanstack/react-query'

export function useLiveEnd() {
  return useMutation({
    mutationFn: (liveId: string) => endLive(liveId),
    onSuccess: () => {
      // ë°©ì†¡ ì¢…ë£Œ ì²˜ë¦¬
    },
  })
}

// ì‚¬ìš©
const endMutation = useLiveEnd()

const handleEndBroadcast = () => {
  endMutation.mutate(params.id)
}
```

---

## ì²´í¬ë¦¬ìŠ¤íŠ¸

ë¼ì´ë¸Œ ì»¤ë¨¸ìŠ¤ ê¸°ëŠ¥ êµ¬í˜„ ì‹œ:

- [ ] ë¹„ë””ì˜¤ ìŠ¤íŠ¸ë¦¬ë° ì—°ë™ (WebRTC, OpenVidu ë“±)
- [ ] ì±„íŒ… WebSocket ì—°ë™
- [ ] ì¢‹ì•„ìš” API ì—°ë™
- [ ] ì‹œì²­ì ìˆ˜ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
- [ ] ë°©ì†¡ ì‹œì‘/ì¢…ë£Œ API
- [ ] ì§„í–‰ì ê¶Œí•œ ì²´í¬ (AuthGuard + ê¶Œí•œ í™•ì¸)
- [ ] ì±„íŒ… ë©”ì‹œì§€ ê¸¸ì´ ì œí•œ (í˜„ì¬ 200ì)
- [ ] ë¹„ì†ì–´ í•„í„°ë§
- [ ] ì±„íŒ… ì‹ ê³  ê¸°ëŠ¥
- [ ] ë°©ì†¡ ë…¹í™”/ë‹¤ì‹œë³´ê¸° ê¸°ëŠ¥ (ì„ íƒ)

---

## ì°¸ê³  ìë£Œ

- **OpenVidu ê³µì‹ ë¬¸ì„œ**: https://docs.openvidu.io/
- **WebSocket ê°€ì´ë“œ**: https://developer.mozilla.org/en-US/docs/Web/API/WebSocket
- **ReactQuery ê°€ì´ë“œ**: [AUTH_GUARD_GUIDE.md](./AUTH_GUARD_GUIDE.md)

---

**ì‘ì„±ì¼:** 2025-11-10  
**ë§ˆì§€ë§‰ ìˆ˜ì •:** 2025-11-10

